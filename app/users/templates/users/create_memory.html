{% extends "users/base.html" %}

{% block content %}
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="form-group">
        <label for="deceasedFirstName">First Name of Deceased</label>
        <input type="text" class="form-control" id="deceasedFirstName" name="deceased_first_name" placeholder="Enter First Name">
    </div>

    <div class="form-group">
        <label for="deceasedLastName">Last Name of Deceased</label>
        <input type="text" class="form-control" id="deceasedLastName" name="deceased_last_name" placeholder="Enter Last Name">
    </div>

    <div class="form-group">
        <label for="deceasedMiddleName">Middle Name of Deceased</label>
        <input type="text" class="form-control" id="deceasedMiddleName" name="deceased_middle_name" placeholder="Enter Middle Name">
    </div>

    <div class="form-group">
        <label for="deceasedBirthDate">Birth Date</label>
        <input type="date" class="form-control" id="deceasedBirthDate" name="deceased_birth_date">
    </div>

    <div class="form-group">
        <label for="deceasedDeathDate">Death Date</label>
        <input type="date" class="form-control" id="deceasedDeathDate" name="deceased_death_date">
    </div>

    <div class="form-group">
        <label for="epitaph">Epitaph</label>
        <textarea class="form-control" id="epitaph" name="epitaph" rows="3"></textarea>
    </div>

    <!-- Дополнительные поля для расширенной информации -->
    <div class="form-group">
        <label for="biography">Biography</label>
        <textarea class="form-control" id="biography" name="biography" rows="4"></textarea>
    </div>
    {% if request.user_subscription_type %}
    <input  type="hidden" id="hiddenAwards" name="awards">
    <input  type="hidden" id="hiddenFamilyMembers" name="family_members">

    <div class="container">
        <div class="row">
            <!-- Блок Наград -->
            <div class="col-md-6">
                <div class="form-group">
                    <label>Awards</label>
                    <div id="awards-list">
                        <!-- Сюда добавляются элементы -->
                    </div>
                    <!-- Кнопка для открытия модального окна -->
                    <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#awardModal">Add Award</button>
                </div>
            </div>
    
            <!-- Блок Семейного Состава -->
            <div class="col-md-6">
                <div class="form-group">
                    <label>Family</label>
                    <div id="family-list">
                        <!-- Сюда добавляются элементы -->
                    </div>
                    <!-- Кнопка для открытия модального окна -->
                    <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#familyModal">Add Family</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для Наград -->
<!-- Модальное окно для Наград -->
<div class="modal fade" id="awardModal" tabindex="-1" role="dialog" aria-labelledby="awardModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="awardModalLabel">Add Award</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Форма для добавления награды -->
                <div class="form-group">
                    <label for="awardDate">Date</label>
                    <input type="date" class="form-control" id="awardDate" name="award_date">
                </div>
                <div class="form-group">
                    <label for="awardTitle">Title</label>
                    <input type="text" class="form-control" id="awardTitle" name="award_title">
                </div>
                <div class="form-group">
                    <label for="awardDescription">Description</label>
                    <textarea class="form-control" id="awardDescription" name="award_description"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="addAward()">Save changes</button>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно для Семейного Состава -->
<div class="modal fade" id="familyModal" tabindex="-1" role="dialog" aria-labelledby="familyModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="familyModalLabel">Add Family Member</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Форма для добавления члена семьи -->
                <div class="form-group">
                    <label for="familyName">Name</label>
                    <input type="text" class="form-control" id="familyName" name="family_name">
                </div>
                <div class="form-group">
                    <label for="familyRelation">Relation</label>
                    <input type="text" class="form-control" id="familyRelation" name="family_relation">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="addFamilyMember()">Save changes</button>
            </div>
        </div>
    </div>
</div>
    {% endif %}
    <button type="submit" class="btn btn-primary">Submit</button>
</form>

<script>
    function addAward() {
        // Получение данных из формы модального окна наград
        var awardDate = document.getElementById('awardDate').value;
        var awardTitle = document.getElementById('awardTitle').value;
        var awardDescription = document.getElementById('awardDescription').value;
    
        // Создание нового элемента для списка наград
        var awardEntry = document.createElement('div');
        awardEntry.classList.add('award-entry');
        awardEntry.innerHTML = `
            <p>Date: <span class="award-date">${awardDate}</span></p>
            <p>Title: <span class="award-title">${awardTitle}</span></p>
            <p>Description: <span class="award-description">${awardDescription}</span></p>
        `;
    
        // Добавление нового элемента в контейнер наград
        document.getElementById('awards-list').appendChild(awardEntry);
    
        // Очистка формы и закрытие модального окна
        $('#awardModal').modal('hide');
        document.getElementById('awardDate').value = '';
        document.getElementById('awardTitle').value = '';
        document.getElementById('awardDescription').value = '';

        updateHiddenField('awards');
    }


    function addFamilyMember() {
        // Получение данных из формы модального окна семьи
        var familyName = document.getElementById('familyName').value;
        var familyRelation = document.getElementById('familyRelation').value;
    
        // Создание нового элемента для списка семьи
        var familyEntry = document.createElement('div');
        familyEntry.classList.add('family-entry');
        familyEntry.innerHTML = `
            <p>Name: <span class="family-name">${familyName}</span></p>
            <p>Relation: <span class="family-relation">${familyRelation}</span></p>
        `;
    
        // Добавление нового элемента в контейнер семьи
        document.getElementById('family-list').appendChild(familyEntry);
    
        // Очистка формы и закрытие модального окна
        $('#familyModal').modal('hide');
        document.getElementById('familyName').value = '';
        document.getElementById('familyRelation').value = '';
    
        updateHiddenField('family_members');
    }

    function updateHiddenField(type) {
        var items = [];
        if (type === 'awards') {
            var awards = document.querySelectorAll('.award-entry');
            awards.forEach(function(award) {
                items.push({
                    date: award.querySelector('.award-date').textContent,
                    title: award.querySelector('.award-title').textContent,
                    description: award.querySelector('.award-description').textContent
                });
            });
            document.getElementById('hiddenAwards').value = JSON.stringify(items);
    } else if (type === 'family_members') {
        var familyMembers = document.querySelectorAll('.family-entry');
        familyMembers.forEach(function(member) {
            items.push({
                name: member.querySelector('.family-name').textContent,
                relation: member.querySelector('.family-relation').textContent
            });
        });
        document.getElementById('hiddenFamilyMembers').value = JSON.stringify(items);
    }
}
</script>
{% endblock %}